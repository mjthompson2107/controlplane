#!/usr/bin/env bash
(
	export PATH="$VCWC_EXECUTIONPLANE_APIINTERNALPATH_VCWC"
	. executionplane-invoke "$0 $@"
	imageName="${@: -1}"
	. invoke-script $imageName environment

	case $1 in
		--info)
			. info-summary release
		;;
		--save)
			repo-save $imageName
		;;
		--hub)
  		executionplane docker tag "${VCWC_REGISTRY}$imageName" "$imageName:latest"
			executionplane "--errors-only" docker image push "$imageName:latest"
			if [[ "${VCWC_TAG}" != "" ]] ; then
				executionplane docker tag "${VCWC_REGISTRY}$imageName" "$imageName:${VCWC_TAG}"
				executionplane "--errors-only" docker image push "$imageName:${VCWC_TAG}"
			fi
		;;
		*)
			executionplane "--errors-only" docker image push "$VCWC_REGISTRY$imageName:latest"
			if [[ "${VCWC_TAG}" != "" ]] ; then
				executionplane "--errors-only" docker image push "$VCWC_REGISTRY$imageName:${VCWC_TAG}"
			fi
		;;
	esac
  executionplane-complete
)
