#!/usr/bin/env bash
imageName=$1
scriptFile=$2
shift
shift
rootPath="/vcwc/pwd/${imageName}"
if [[ -d $rootPath ]] ; then
	if [[ -f $rootPath/$scriptFile ]] ; then
		chmod 777 $rootPath/$scriptFile
		. $rootPath/$scriptFile $@
	else
		executionplane-warning "$scriptFile: Requested file does not exist!"
	fi
else
	tmpfile=$(mktemp /tmp/run-script.XXXXXX)
	. executionplane-capture-output docker create ${VCWC_REGISTRY}$imageName
	executionplane docker container cp ${VCWC_EXECUTIONPLANE_OUTPUT}:/vcwc/repo/${scriptFile} $tmpfile
	. $tmpfile $@
	rm $tmpfile
fi
